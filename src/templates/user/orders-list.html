{% extends "profile_page_base.html" %}
{% load static %}
{% block title %}سفارشات من{% endblock %}

{% block main_content %}
    			<!-- =========================== My All Orders =================================== -->
    						<div class="col-lg-8 col-md-9">

							<!-- Order Items -->
							<div class="card style-2">
								<div class="card-header">
									<h4 class="mb-0">سفارشات من</h4>
								</div>
								<div class="card-body">
									<div class="table-responsive">
										<table class="table" id="order-table">
											<thead>
												<tr>
													<th scope="col">شماره سفارش</th>
													<th scope="col">تاریخ ثبت سفارش</th>
													<th scope="col">مجموع قیمت سفارش</th>
													<th scope="col">وضعیت</th>
													<th scope="col">پیگیری</th>
												</tr>
											</thead>
											<tbody>
                                            </tbody>
										</table>
									</div>
								</div>
							</div>

						</div>
    			<!-- =========================== My All Orders =================================== -->
{% endblock %}
{% block scr %}
    <script>
    $(document).ready(function () {
        function populateTable(data) {
            const tableBody = $("#order-table tbody");

    data.forEach(item => {
        const row = $("<tr></tr>");

        row.append($("<td></td>").html(`<a href="profile/order-detail/${item.pk}/"></a>${item.pk}`));
        row.append($("<td></td>").html(`${item.create_date}`));
        row.append($("<td></td>").html(`${item.cart.total_price}`));
        row.append($("<td></td>").html(`${item.status}`));
        row.append($("<td></td>").html(`<a href="profile/order_tracking/${item.pk}/" class="btn btn-sm btn-theme">پیگیری سفارش</a>`));
        tableBody.append(row);
    });
}
        async function authenticate(event) {
            event.preventDefault()
            const response = await fetch("/api/v1/user/token/", {
                method: "GET",
            })
            if (response.status === 200) {
                $.getJSON('/api/v1/user/orders-list/', function (data)
                {
                    populateTable(data);
                });
                $("#page_title").text("سفارشات من");
                $("#current_page").text("سفارشات من");
                $("#order_list").attr("class", "list-group-item list-group-item-action dropright-toggle active");
            } else {
                $("#page").html(`<div class="container"><div class="row"><div class="col-lg-12 col-md-12 text-center"><h2 class="error_title">4<span class="text-primary">0</span>1<i class="ti-help"></i></h2><p><span class="text-primary"></span> متأسفیم ، مشکلی در دسترسی شما به صفحه مورد نظر بوجود آمد</p><a href="/" class="btn btn-primary">بازگشت به صفحه اصلی</a></div></div></div>`);
            }
}
        authenticate(event)
    })
    </script>
    <!-- ============================= Fetch API ==================================== -->
{#    <script>#}
{##}
{#        async function updateinfo(event, el) {#}
{#            event.preventDefault()#}
{##}
{#            var year = $("#year").val();#}
{#            var month = $("#month").val();#}
{#            var day = $("#day").val();#}
{#            var dateString = year + "-" + month + "-" + day;#}
{##}
{#            var form = document.getElementById("my-form");#}
{#            var formData = new FormData(form);#}
{##}
{#            formData.set("birthday", dateString);#}
{##}
{#            const response = await fetch("/api/v1/user/user-information/", {#}
{#                method: "patch",#}
{#                body: formData,#}
{#            });#}
{##}
{#            if (response.status === 200) {#}
{#                alert("اطلاعات با موفقیت بروزرسانی شد")#}
{##}
{#               $.getJSON('/api/v1/user/user-information/', function (data) {#}
{#                    $('input[name=first_name]').val(data.first_name);#}
{#                    $('input[name=last_name]').val(data.last_name);#}
{#                    $('#user_pic').attr("src", data.profile_pic);#}
{#                    $("div.id_100 select").val(data.gender).change();#}
{#                    $("#profile_pic").val(data.profile_pic)#}
{#                    var datestr = data.birthday;#}
{#                    var dateArr = datestr.split("-");#}
{#                    var year = dateArr[0];#}
{#                    var month = dateArr[1];#}
{#                    var day = dateArr[2];#}
{##}
{#                    $('input[name=year]').val(year);#}
{#                    $('input[name=month]').val(month);#}
{#                    $('input[name=day]').val(day);#}
{#                });#}
{#            } else {#}
{#                alert("ثبت اطلاعات جدید با مشکل همراه شد")#}
{#            }#}
{#        }#}
{#    </script>#}
{#    <!-- ============================= Fetch API ==================================== -->#}
{% endblock %}