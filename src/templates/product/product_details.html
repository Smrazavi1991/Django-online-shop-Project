{% extends "landing_page_base.html" %}
{% load static %}
{% load humanize %}

{% block title %} اودکس شاپ - {{ object.name }}{% endblock %}
{% block content %}
    			<!-- =========================== Breadcrumbs =================================== -->
			<div class="breadcrumbs_wrap dark">
				<div class="container">
					<div class="row align-items-center">

						<div class="col-lg-12 col-md-12 col-sm-12 col-12">
						</div>

					</div>
				</div>
			</div>
			<!-- =========================== Breadcrumbs =================================== -->


			<!-- =========================== Product Detail =================================== -->
			<section>
				<div class="container">
					<div class="row">

						<div class="col-lg-6 col-md-12 col-sm-12">
							<div class="sp-wrap">
                            {% for picture in product_pictures %}
                            {% if picture.image %}
                            {% for img in picture.image %}
								<a id="image" href="{{ img.image.url }}"><img src="{{ img.image.url }}" alt=""></a>
                            {% endfor %}
                            {% else %}
                                <img src="{% static "No_Image_Available.jpg" %}" alt="" />
                            {% endif %}
                            {% endfor %}
                            </div>
						</div>

						<div class="col-lg-6 col-md-12 col-sm-12">
							<div class="woo_pr_detail">

								<div class="woo_cats_wrps">
                                    {% for discount in discounted_price %}
                                    {% if discount.price != None %}
									<span class="woo_pr_trending">ویژه</span>
                                    {% endif %}
                                    {% endfor %}
								</div>
								<h2 class="woo_pr_title">{{ object.name }}</h2>

								<div class="woo_pr_reviews">

								</div>

								<div class="woo_pr_price">
									<div class="woo_pr_offer_price">
										{%  for discount in discounted_price %}
                                            <p id="price" hidden="hidden">{{ discount.price }}</p>
                                            {% if discount.id == product.id %}
                                            {% if discount.price == None %}
                                            <h3>{{ product.price|intcomma }} تومان</h3>
                                            {% else %}
                                            <h3>{{ discount.price|intcomma }}تومان  <span class="org_price">{{ product.price|intcomma }}تومان</span></h3>
                                            {% endif %}
                                            {% endif %}
                                            {% endfor %}

									</div>
								</div>

								<div class="short_products_info_body mb-3 mt-3">

									<!-- Single Option -->
									<div class="single_search_boxed">
										<div class="widget-boxed-header">
											<h4><a href="#productinfo" data-toggle="collapse" aria-expanded="false" role="button"><i class="ti-info ml-2 ti-info"></i>اطلاعات محصول</a></h4>
										</div>
										<div class="widget-boxed-body collapse show" id="productinfo" data-parent="#productinfo">
											<div class="side-list no-border">
												<!-- Single Filter Card -->
												<div class="single_filter_card">
													<div class="card-body pt-0">
                                                        {% for info in object.product_info %}
                                                        {% for i in info.num %}
														<h6 class="font-size-sm mb-2">{{ i.item }}</h6>
                                                        {% endfor %}
                                                        {% endfor %}
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>

								<div class="woo_btn_action">
									<div class="col-12 col-lg-auto">
                                        {% if object.count >= 1 %}
										<button type="submit" formmethod="post" onclick="add_to_cart(event, this)" class="btn btn-block btn-dark mb-2">افزودن به سبد خرید <i class="ti-shopping-cart-full mr-2"></i></button>
                                        {% else %}
                                        <button class="btn btn-block btn-dark mb-2">در انبار موجود نیست </button>
                                        {% endif %}
									</div>
								</div>

							</div>
						</div>

					</div>

					<!-- Product Description -->
					<div class="row mt-5">
						<div class="col-lg-12 col-md-12">
							<div class="custom-tab style-1">
								<ul class="nav nav-tabs" id="myTab" role="tablist">
									<li class="nav-item">
										<a class="nav-link active" id="description-tab" data-toggle="tab" href="#description" role="tab" aria-controls="description" aria-selected="true" aria-expanded="true">توضیحات</a>
									</li>
									<li class="nav-item">
										<a class="nav-link" id="information-tab" data-toggle="tab" href="#information" role="tab" aria-controls="information" aria-selected="false" aria-expanded="false">اطلاعات تکمیلی</a>
									</li>
									<li class="nav-item">
										<a class="nav-link" id="reviews-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="reviews" aria-selected="false" aria-expanded="false">نظرات</a>
									</li>
								</ul>
								<div class="tab-content" id="myTabContent">
									<div class="tab-pane fade active show" id="description" role="tabpanel" aria-labelledby="description-tab" aria-expanded="true">
										<p>لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ، و با استفاده از طراحان گرافیک است، چاپگرها و متون بلکه روزنامه و مجله در ستون و سطرآنچنان که لازم است، و برای شرایط فعلی تکنولوژی مورد نیاز، و کاربردهای متنوع با هدف بهبود ابزارهای کاربردی می باشد، کتابهای زیادی در شصت و سه درصد گذشته حال و آینده.</p>
									</div>
									<div class="tab-pane fade" id="information" role="tabpanel" aria-labelledby="information-tab" aria-expanded="false">
										<p>لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ، و با استفاده از طراحان گرافیک است، چاپگرها و متون بلکه روزنامه و مجله در ستون و سطرآنچنان که لازم است، و برای شرایط فعلی تکنولوژی مورد نیاز، و کاربردهای متنوع با هدف بهبود ابزارهای کاربردی می باشد.</p>
										<div class="product_meta">
											<span class="sku_wrapper">شماره محصول: <span class="sku">{{ object.id }}</span></span>
										</div>
									</div>
									<div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab" aria-expanded="false">
										<div class="review-wrapper">
											<div class="review-wrapper-header">
												<h4>{{ product_comments|length }} نظر</h4>
											</div>
											<div class="review-wrapper-body">
												<ul class="review-list">
                                                    {% for product_comment in product_comments %}
													<li>
														<div class="reviews-box">
															<div class="review-body">
																<div class="review-avatar">
																	<img alt="" src={{ product_comment.owner.profile_pic.url }} class="avatar avatar-140 photo">
																</div>
																<div class="review-content">
																	<div class="review-info">
																		<div class="review-comment">
																			<div class="review-author">
                                                                                {{ product_comment.owner }}{% if product_comment.reply %} در پاسخ به {{ product_comment.reply.owner }}{% endif %}
																			</div>
																		</div>
																	</div>
																	<p>{{ product_comment.description }}</p>
																</div>
															</div>
														</div>
													</li>
                                                {% endfor %}
                                                </ul>

										<div class="review-wrapper">
											<div class="review-wrapper-header">
												<br>
                                                <h4>ارزیابی و نوشتن نظرات</h4>
											</div>
											<div class="review-wrapper-body">

												<div class="row mb-3">
													<div class="col-md-12">
													</div>
												</div>

												<div class="row">
													<div class="col-sm-12 form-group">
														<textarea class="form-control height-110" placeholder="تجربه خود را برای ما بگویید... (این بخش در حال حاضر فعال نیست.)"></textarea>
													</div>
													<div class="col-sm-12">
														<button type="button" class="btn btn-primary">ارسال نظرات</button>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

				</div>
			</section>
			<!-- =========================== Product Detail =================================== -->
            <!-- ============================= Fetch API ==================================== -->
            <script>

        async function add_to_cart(event, el) {
            event.preventDefault()

            const response = await fetch("/api/v1/cart/add_to_cart/", {
                method: el.formMethod,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    pk: "{{ object.pk }}",
                    name: "{{ object.name }}",
                    price: {{ object.price }},
                    discounted_price: document.getElementById('price').innerHTML,
                })
            })

            if (response.status === 200){
                alert("کالا به سبد خرید اضافه شد.")
            } else if (response.status === 406) {
               alert("این کالا  موجود نیست")
            } else {
               alert("در پروسه ثبت خرید مشکلی رخ داده است.")
            }
        }
        </script>
    <!-- ============================= Fetch API ==================================== -->
{% endblock %}